import { Event, Utility } from '../index.js';
export class Pointer extends Event.Dispatcher {
    static start(eventType = 'pointer', autoTouchEvents = false) {
        if (!this.instance) {
            this.instance = new Pointer(eventType, autoTouchEvents);
        }
    }
    constructor(eventType = 'pointer', autoTouchEvents = false, target = document) {
        super();
        this.angle = 0;
        this.changed = false;
        this.distance = 0;
        this.down = false;
        this.dx = 0;
        this.dy = 0;
        this.friction = 0.95;
        this.inertia = 0;
        this.lastX = 0;
        this.lastY = 0;
        this.moved = false;
        this.rx = 0;
        this.rx2 = 0;
        this.ry = 0;
        this.ry2 = 0;
        this.rox = 0;
        this.roy = 0;
        this.rox2 = 0;
        this.roy2 = 0;
        this.ox = 0;
        this.oy = 0;
        this.time = Date.now();
        this.timeDown = 0;
        this.timeDownDifference = 0;
        this.timeDifference = 0;
        this.vx = 0;
        this.vy = 0;
        this.x = 0;
        this.x2 = 0;
        this.y = 0;
        this.y2 = 0;
        this.wheel = false;
        this.wheelDelta = 0;
        this.moveThreshold = 5;
        this.cid = Math.random().toString(36).substr(2, 9);
        this.eventType = '';
        this.vxHistory = [];
        this.vyHistory = [];
        this.Handle_OnInterval = this.Handle_OnInterval.bind(this);
        this.Handle_OnPointerDown = this.Handle_OnPointerDown.bind(this);
        this.Handle_OnPointerMove = this.Handle_OnPointerMove.bind(this);
        this.Handle_OnPointerUp = this.Handle_OnPointerUp.bind(this);
        this.Handle_OnWheel = this.Handle_OnWheel.bind(this);
        this.autoTouchEvents = autoTouchEvents;
        this.eventType = eventType;
        this.target = target;
        console.log('target', this.target);
        this.attachEvents();
    }
    attachEvents() {
        if (typeof window !== 'undefined' && 'ontouchstart' in window && this.autoTouchEvents) {
            this.target.addEventListener('touchstart', this.Handle_OnPointerDown);
            this.target.addEventListener('touchmove', this.Handle_OnPointerMove);
            this.target.addEventListener('touchend', this.Handle_OnPointerUp);
        }
        else {
            this.target.addEventListener(this.downEvent, this.Handle_OnPointerDown);
            this.target.addEventListener(this.moveEvent, this.Handle_OnPointerMove);
            this.target.addEventListener(this.upEvent, this.Handle_OnPointerUp);
        }
        this.target.addEventListener('wheel', this.Handle_OnWheel, {
            passive: false,
        });
        Utility.Interval.add(this.Handle_OnInterval, 1000 / 60, `${this.cid}-pointer-velocity`);
    }
    detachEvents() {
        if (typeof window !== 'undefined' && 'ontouchstart' in window && this.autoTouchEvents) {
            this.target.removeEventListener('touchstart', this.Handle_OnPointerDown);
            this.target.removeEventListener('touchmove', this.Handle_OnPointerMove);
            this.target.removeEventListener('touchend', this.Handle_OnPointerUp);
        }
        else {
            this.target.removeEventListener(this.downEvent, this.Handle_OnPointerDown);
            this.target.removeEventListener(this.moveEvent, this.Handle_OnPointerMove);
            this.target.removeEventListener(this.upEvent, this.Handle_OnPointerUp);
        }
        this.target.removeEventListener('wheel', this.Handle_OnWheel);
        Utility.Interval.remove(`${this.cid}-pointer-velocity`);
    }
    capturePinchZoom(capture) {
        document.addEventListener('wheel', (e) => {
            if (capture) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
            }
            this.Handle_OnWheel(e);
        }, {
            capture: capture,
            passive: false,
        });
        document.body.style.touchAction = 'pan-x pan-y';
        document.body.style.userSelect = 'none';
    }
    resetRelative(x = 0, y = 0) {
        this.rox = this.rox2 = this.rx = this.rx2 = x;
        this.roy = this.roy2 = this.ry = this.ry2 = y;
        return this;
    }
    get downEvent() {
        let output = '';
        switch (this.eventType) {
            case 'pointer':
                output = 'pointerdown';
                break;
            case 'touch':
                output = 'touchstart';
                break;
            default:
                output = 'mousedown';
                break;
        }
        return output;
    }
    get moveEvent() {
        let output = '';
        switch (this.eventType) {
            case 'pointer':
                output = 'pointermove';
                break;
            case 'touch':
                output = 'touchmove';
                break;
            default:
                output = 'mousemove';
                break;
        }
        return output;
    }
    get upEvent() {
        let output = '';
        switch (this.eventType) {
            case 'pointer':
                output = 'pointerup';
                break;
            case 'touch':
                output = 'touchend';
                break;
            default:
                output = 'mouseup';
                break;
        }
        return output;
    }
    getDistanceBetweenTouches(e) {
        if (e.touches.length < 2)
            return 0;
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];
        const dx = touch1.pageX - touch2.pageX;
        const dy = touch1.pageY - touch2.pageY;
        return Math.sqrt(dx * dx + dy * dy);
    }
    async Handle_OnInterval() {
        const ovx = this.vx;
        const ovy = this.vy;
        this.vx *= this.friction;
        this.vy *= this.friction;
        if (Math.abs(this.vx) < 0.025) {
            this.vx = 0;
        }
        if (Math.abs(this.vy) < 0.025) {
            this.vy = 0;
        }
        if (!isFinite(this.vx)) {
            this.vx = 0;
        }
        if (!isFinite(this.vy)) {
            this.vy = 0;
        }
        if (!this.down) {
            this.x2 += this.vx * 5;
            this.y2 += this.vy * 5;
            this.rx2 += this.vx * 5;
            this.ry2 += this.vy * 5;
        }
        this.changed = this.vx !== ovx || this.vy !== ovy;
    }
    async Handle_OnPointerDown(e) {
        this.down = true;
        this.moved = false;
        this.timeDown = Date.now();
        this.ox = this.x = 'touches' in e ? e.touches[0].clientX : e.clientX;
        this.oy = this.y = 'touches' in e ? e.touches[0].clientY : e.clientY;
        if (this.target !== document) {
            const rect = this.target.getBoundingClientRect();
            this.ox -= rect.left;
            this.oy -= rect.top;
        }
        this.rox = this.rx;
        this.roy = this.ry;
        this.rox2 = this.rx2;
        this.roy2 = this.ry2;
        this.dispatch('down', {
            x: this.x,
            y: this.y,
        });
    }
    async Handle_OnPointerMove(e) {
        this.lastX = this.x;
        this.lastY = this.y;
        this.x = 'touches' in e ? e.touches[0].clientX : e.clientX;
        this.y = 'touches' in e ? e.touches[0].clientY : e.clientY;
        if (this.target !== document) {
            const rect = this.target.getBoundingClientRect();
            this.x -= rect.left;
            this.y -= rect.top;
        }
        this.currentTarget = e.currentTarget;
        this.activeTarget = e.target;
        this.timeDifference = Date.now() - this.time;
        this.time = Date.now();
        this.dispatch('move', {
            x: this.x,
            y: this.y,
        });
        this.vxHistory.push((this.x - this.lastX) / this.timeDifference);
        this.vyHistory.push((this.y - this.lastY) / this.timeDifference);
        if (this.vxHistory.length > 5)
            this.vxHistory.shift();
        if (this.vyHistory.length > 5)
            this.vyHistory.shift();
        if (this.down) {
            this.dx = this.x - this.ox;
            this.dy = this.y - this.oy;
            this.rx = this.rox + this.dx;
            this.ry = this.roy + this.dy;
            this.rx2 = this.rox2 + this.dx;
            this.ry2 = this.roy2 + this.dy;
            this.angle = Math.atan2(this.dy, this.dx) * (180 / Math.PI);
            this.distance = Math.sqrt(Math.pow(this.dx, 2) + Math.pow(this.dy, 2));
            this.moved = Math.abs(this.distance) > this.moveThreshold;
            this.x2 = this.x;
            this.y2 = this.y;
            this.timeDownDifference = this.time - this.timeDown;
            this.inertia = Math.sqrt(Math.pow(this.dx, 2) + Math.pow(this.dy, 2));
            this.vx = this.vxHistory.reduce((a, b) => a + b) / (this.vxHistory.length || 1);
            this.vy = this.vyHistory.reduce((a, b) => a + b) / (this.vyHistory.length || 1);
            this.dispatch('drag', {
                angle: this.angle,
                changed: this.changed,
                distance: this.distance,
                dx: this.dx,
                dy: this.dy,
                inertia: this.inertia,
                moved: this.moved,
                ox: this.ox,
                oy: this.oy,
                rx: this.rx,
                ry: this.ry,
                rx2: this.rx2,
                ry2: this.ry2,
                time: this.time,
                timeDown: this.timeDown,
                timeDownDifference: this.timeDownDifference,
                timeDifference: this.timeDifference,
                vx: this.vx,
                vy: this.vy,
                x: this.x,
                y: this.y,
            });
        }
    }
    async Handle_OnPointerUp(e) {
        this.down = false;
        this.dispatch('up', {
            x: this.x,
            y: this.y,
        });
    }
    async Handle_OnWheel(e) {
        const isTrackpad = ~~(Math.abs(e.wheelDeltaY || 1) / Math.abs(e.deltaY || 1)) > 1;
        const deltaY = e.deltaY;
        const direction = deltaY > 0 ? 'out' : 'in';
        Utility.Debounce.exec(this.cid, () => {
            this.wheel = false;
            this.wheelDelta = 0;
        }, 100, true);
        if (deltaY) {
            this.wheel = true;
        }
        this.wheelDelta = deltaY;
        this.dispatch('zoom', {
            delta: deltaY * -1,
            direction: direction,
            isTrackpad: isTrackpad,
        });
        this.dispatch('zoom:' + direction, {
            delta: deltaY * -1,
            isTrackpad: isTrackpad,
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUG9pbnRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9JbnB1dC9Qb2ludGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBOEM3QyxNQUFNLE9BQU8sT0FBUSxTQUFRLEtBQUssQ0FBQyxVQUFVO0lBY3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsWUFBb0IsU0FBUyxFQUFFLGtCQUEyQixLQUFLO1FBQ2xGLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEVBQUUsZUFBZSxDQUFDLENBQUM7UUFDekQsQ0FBQztJQUNGLENBQUM7SUFtUkQsWUFBWSxZQUFvQixTQUFTLEVBQUUsa0JBQTJCLEtBQUssRUFBRSxTQUFpQyxRQUFRO1FBQ3JILEtBQUssRUFBRSxDQUFDO1FBMVBGLFVBQUssR0FBVyxDQUFDLENBQUM7UUFPbEIsWUFBTyxHQUFZLEtBQUssQ0FBQztRQU96QixhQUFRLEdBQVcsQ0FBQyxDQUFDO1FBT3JCLFNBQUksR0FBWSxLQUFLLENBQUM7UUFPdEIsT0FBRSxHQUFXLENBQUMsQ0FBQztRQU9mLE9BQUUsR0FBVyxDQUFDLENBQUM7UUFPZixhQUFRLEdBQVcsSUFBSSxDQUFDO1FBT3hCLFlBQU8sR0FBVyxDQUFDLENBQUM7UUFPcEIsVUFBSyxHQUFXLENBQUMsQ0FBQztRQU9sQixVQUFLLEdBQVcsQ0FBQyxDQUFDO1FBT2xCLFVBQUssR0FBWSxLQUFLLENBQUM7UUFPdkIsT0FBRSxHQUFXLENBQUMsQ0FBQztRQU9mLFFBQUcsR0FBVyxDQUFDLENBQUM7UUFPaEIsT0FBRSxHQUFXLENBQUMsQ0FBQztRQU9mLFFBQUcsR0FBVyxDQUFDLENBQUM7UUFPaEIsUUFBRyxHQUFXLENBQUMsQ0FBQztRQUNoQixRQUFHLEdBQVcsQ0FBQyxD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QUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0IsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0IsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDN0IsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDN0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDL0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDL0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM1RCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZFLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQztZQUMxRCxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDakIsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FB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