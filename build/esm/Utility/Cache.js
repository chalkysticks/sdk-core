export class Cache {
    constructor(ttl = -1) {
        this.storage = {};
        this.ttl = ttl > 0 ? ttl : 0;
    }
    all() {
        const keys = Object.keys(this.storage);
        const output = {};
        let value;
        for (const key of keys) {
            value = this.get(key);
            if (value !== undefined) {
                output[key] = this.get(key);
            }
        }
        return output;
    }
    delete(key) {
        if (this.storage[key]) {
            delete this.storage[key];
        }
    }
    get(key) {
        const item = this.storage[key];
        let value;
        if (!item) {
            value = undefined;
        }
        else if (item.ttl === 0) {
            value = item.value;
            this.delete(key);
        }
        else if (this.isCachedItemHealthy(item)) {
            value = item.value;
        }
        return value;
    }
    exists(key) {
        return this.storage[key] !== undefined;
    }
    has(key) {
        return this.get(key) !== undefined;
    }
    set(key, value, ttl = 0, immutable = false) {
        const hasItem = this.has(key);
        const time = Date.now();
        if (hasItem && this.isImmutable(key)) {
            return false;
        }
        this.storage[key] = {
            immutable,
            time,
            ttl,
            value,
        };
        return true;
    }
    isCachedItemHealthy(item) {
        const now = Date.now();
        const then = item.time;
        const ttl = item.ttl;
        return then + ttl > now;
    }
    isImmutable(key) {
        const item = this.storage[key];
        return !!item?.immutable;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2FjaGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvVXRpbGl0eS9DYWNoZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUE4QkEsTUFBTSxPQUFPLEtBQUs7SUFnQmQsWUFBWSxNQUFjLENBQUMsQ0FBQztRQVpwQixZQUFPLEdBQWdDLEVBQUUsQ0FBQztRQWE5QyxJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFLTSxHQUFHO1FBQ04sTUFBTSxJQUFJLEdBQWEsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDakQsTUFBTSxNQUFNLEdBQVEsRUFBRSxDQUFDO1FBQ3ZCLElBQUksS0FBVSxDQUFDO1FBRWYsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNyQixLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUV0QixJQUFJLEtBQUssS0FBSyxTQUFTLEVBQUUsQ0FBQztnQkFDdEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDaEMsQ0FBQztRQUNMLENBQUM7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNsQixDQUFDO0lBTU0sTUFBTSxDQUFDLEdBQVc7UUFDckIsSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDcEIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLENBQUM7SUFDTCxDQUFDO0lBTU0sR0FBRyxDQUFDLEdBQVc7UUFFbEIsTUFBTSxJQUFJLEdBQWdCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsSUFBSSxLQUFVLENBQUM7UUFHZixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDUixLQUFLLEdBQUcsU0FBUyxDQUFDO1FBQ3RCLENBQUM7YUFHSSxJQUFJLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDdEIsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDbkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQixDQUFDO2FBR0ksSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN0QyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN2QixDQUFDO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQVNNLE1BQU0sQ0FBQyxHQUFXO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxTQUFTLENBQUM7SUFDM0MsQ0FBQztJQVFNLEdBQUcsQ0FBQyxHQUFXO1FBQ2xCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxTQUFTLENBQUM7SUFDdkMsQ0FBQztJQVlNLEdBQUcsQ0FBQyxHQUFXLEVBQUUsS0FBVSxFQUFFLE1BQWMsQ0FBQyxFQUFFLFlBQXFCLEtBQUs7UUFDM0UsTUFBTSxPQUFPLEdBQVksSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2QyxNQUFNLElBQUksR0FBVyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFHaEMsSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ25DLE9BQU8sS0FBSyxDQUFDO1FBQ2pCLENBQUM7UUFHRCxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHO1lBQ2hCLFNBQVM7WUFDVCxJQUFJO1lBQ0osR0FBRztZQUNILEtBQUs7U0FDUixDQUFDO1FBRUYsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQU1PLG1CQUFtQixDQUFDLElBQWlCO1FBQ3pDLE1BQU0sR0FBRyxHQUFXLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMvQixNQUFNLElBQUksR0FBVyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQy9CLE1BQU0sR0FBRyxHQUFXLElBQUksQ0FBQyxHQUFHLENBQUM7UUFFN0IsT0FBTyxJQUFJLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQztJQUM1QixDQUFDO0lBTU8sV0FBVyxDQUFDLEdBQVc7UUFDM0IsTUFBTSxJQUFJLEdBQWdCLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQztJQUM3QixDQUFDO0NBQ0oifQ==